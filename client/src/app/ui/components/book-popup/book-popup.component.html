<div *ngIf="!canManageBook" class="popup-container">
    <div class="book-container">
        <h1 class="about-book-title">{{ 'BOOKS.ABOUT' | translate }}</h1>
        <book-image class="book-image" [book]="book"></book-image>
        <div class="book-information-container">
            <h2 class="book-title">{{ book.title }}</h2>
            <div class="book-information-label">{{ 'BOOKS.FIELD.ISBN' | translate }}
                <div class="book-information-content">{{book.isbn | isbn}}</div>
            </div>
            <div class="book-information-label">{{ 'BOOKS.FIELD.SYNOPSIS' | translate }}</div>
            <div class="book-synopsis">{{book.synopsis}}</div>
            <div class="book-information-label">{{ 'BOOKS.FIELD.EDITION' | translate }}</div>
            <div class="book-synopsis">{{book.edition}}</div>
            <div class="book-information-label">{{ 'BOOKS.FIELD.AUTHORS' | translate }}
                <div class="book-authors" *ngFor="let author of book.authors; last as isLast">
                    {{author.name}}{{isLast ? '' : ', '}}</div>
            </div>
            <div class="book-information-label">{{ 'BOOKS.FIELD.PUBLISHER' | translate }}
                <div class="book-information-content">{{book.publisher.name}}</div>
            </div>
            <div class="book-information-label">{{ 'BOOKS.FIELD.PUBLICATION_YEAR' | translate }}
                <div class="book-information-content">{{book.publicationYear}}</div>
            </div>
        </div>
    </div>
    <div *ngIf="canRequestReservation" class="request-reservation-container">
        <div class="availability-box">
            <div *ngIf="canRequestBookRental" class="available-text">{{ 'BOOKS.AVAILABLE' | translate }}</div>
            <div *ngIf="!isBookAvailable" class="unavailable-text">{{ 'BOOKS.UNAVAILABLE' | translate }}</div>
        </div>
        <div *ngIf="canRequestBookRental" class="reservation-box-available" (click)="order()">
            <div class="available-button-text-available">{{ 'BOOKS.RENT' | translate }}</div>
        </div>
        <div *ngIf="canAddToWaitingList" class="reservation-box-unavailable" (click)="order()">
            <div class="available-button-text-unavailable">{{ 'BOOKS.ADD_WAITING_LIST' | translate }}</div>
        </div>
    </div>
    <div *ngIf="requestedForReservation" class="request-reservation-container">
        <div class="availability-box">
            <div class="suggestion-message">{{ 'BOOKS.MORE_INFORMATION' | translate }}</div>
        </div>
        <div class="waiting-box">
            <div class="sucess-order-text">{{message}}</div>
        </div>
    </div>
    <div *ngIf="wasOrderSuccesfull" class="expired-box">
        <div class="sucess-order-text">{{message}}</div>
    </div>
</div>

<form *ngIf="canManageBook" class="popup-container" [formGroup]="bookForm">
    <div class="book-container">
        <h1 *ngIf="existingBook" class="about-book-title">{{ 'BOOKS.EDIT' | translate }}</h1>
        <h1 *ngIf="isNew" class="about-book-title">{{ 'BOOKS.ADD' | translate }}</h1>
        <div class="image-validation-alert" *ngIf="isUploadedImageInvalid">
            {{ 'IMAGE.REQUIRED' | translate }}
        </div>
        <div class="image-validation-alert" *ngIf="isImageExtensionInvalid">
            {{ 'IMAGE.INVALID' | translate }}
        </div>
        <div *ngIf="allowCoverImage" class="placeholder-image-container"
            [ngClass]="{'input-image-hover': isImageSelected, 'input-invalid':  isImageInvalid}">
            <img class="book-image-loaded" #bookImage *ngIf="hasCoverImageUrl" [src]="coverImageURL">
            <div class="edit-image">
                <div class="edit-image-text" *ngIf="isImageSelected">{{ 'IMAGE.EDIT' | translate }}</div>
            </div>
            <div class="image-hover"></div>
            <load-image class="input-image" #loadImage [formControlName]="'imageControl'"
                (ngModelChange)="setCoverImage($event)"></load-image>
            <book-image class="book-image-loaded" *ngIf="isImageLoaded" [book]="book"></book-image>
            <div *ngIf="!isImageLoaded" class="add-image-button" [innerHTML]="'IMAGE.NEW' | translate"></div>
        </div>       
        <div class="book-inputs-container">
            <label class="input-label" style="margin-top: 0;">{{ 'BOOKS.FIELD.NAME' | translate }}
                <div class="validation-alert" *ngIf="isBookTitleEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
            </label>
            <input [(ngModel)]="book.title" [ngClass]="{ 'input-invalid': isBookTitleInvalid}"
                name="title" type="text" class="textbox-input" formControlName="titleControl" >
            <div class="input-label">{{ 'BOOKS.FIELD.ISBN' | translate }}
                <div class="validation-alert" *ngIf="isIsbnEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
                <div class="validation-alert" *ngIf="isIsbnIncorrect">
                    {{ 'BOOKS.INVALID.ISBN' | translate }}
                </div>
            </div>
            <input numeric [(ngModel)]="book.isbn" [ngClass]="{ 'input-invalid': isIsbnInvalid}" name="isbn"
                maxlength="13" numericType="number" class="textbox-input" formControlName="isbnControl">
            <label class="input-label">{{ 'BOOKS.FIELD.EDITION' | translate }}
                <div class="validation-alert" *ngIf="isBookTitleEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
            </label>
            <input [(ngModel)]="book.edition" [ngClass]="{ 'input-invalid': isBookEditionInvalid}" name="title"
                type="text" class="textbox-input" formControlName="editionControl">
            <label class="input-label">{{ 'BOOKS.FIELD.SYNOPSIS' | translate }}</label>
            <textarea [(ngModel)]="book.synopsis" name="synopsis" type="text" class="synopsis-textarea"
                [ngModelOptions]="{standalone: true}"> </textarea>
            <label class="input-label">{{ 'BOOKS.FIELD.AUTHORS' | translate }}
                <div class="validation-alert" *ngIf="isAuthorEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
            </label>
            <multi-selection-typeahead [ngClass]="{ 'input-invalid': isAuthorInvalid}"
                [suggestionAdapter]="authorSuggestionAdapter" [(ngModel)]="book.authors"
                [formControlName]="'authorsControl'">
            </multi-selection-typeahead>
            <label class="input-label">{{ 'BOOKS.FIELD.PUBLISHER' | translate }}
                <div class="validation-alert" *ngIf="isPublisherEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
            </label>
            <single-selection-typeahead [ngClass]="{ 'input-invalid': isPublisherInvalid}"
                [suggestionAdapter]="publisherSuggestionAdapter" [(ngModel)]="book.publisher"
                [formControlName]="'publisherControl'">
            </single-selection-typeahead>
            <label class="input-label">{{ 'BOOKS.FIELD.PUBLICATION_YEAR' | translate }}
                <div class="validation-alert" *ngIf="isPublicationYearEmpty">
                    {{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
                <div class="validation-alert" *ngIf="isPublicationYearIncorrect">
                    {{ 'BOOKS.INVALID.PUBLICATION_YEAR' | translate }}
                </div>
            </label>
            <input numeric numericType="number" [(ngModel)]="book.publicationYear"
                [ngClass]="{ 'input-invalid': isPublicationYearInvalid}" maxlength="4" min="0" class="textbox-input"
                formControlName="publicationYearControl">
            <label class="input-label">{{ 'BOOKS.FIELD.NUMBER_OF_COPIES' | translate }}
                <div class="validation-alert" *ngIf="isNumberOfCopiesEmpty">{{ 'BOOKS.FIELD.REQUIRED' | translate }}
                </div>
                <div class="validation-alert" *ngIf="isNumberOfCopiesIncorrect">
                    {{ 'BOOKS.INVALID.NUMBER_OF_COPIES' | translate }}
                </div>
            </label>
            <input numeric numericType="number" [(ngModel)]="book.numberOfCopies"
                [ngClass]="{ 'input-invalid': isNumberOfCopiesInvalid}" maxlength="1" class="textbox-input"
                formControlName="numberOfCopiesControl">
        </div>
    </div>
    <div class="create-buttons-container">
        <div *ngIf="canManageBook" class="cancel-button" (click)="onCancel()">
            <div class="available-button-text-available">{{ 'BUTTON.CANCEL' | translate }}</div>
        </div>
        <button *ngIf="canManageBook" class="create-button" [disabled]="!bookForm.valid" (click)="saveBook()">
            <div class="available-button-text-available">{{ 'BUTTON.SAVE' | translate }}</div>
        </button>
    </div>
</form>